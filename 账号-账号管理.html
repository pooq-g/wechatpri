<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="layui/css/layui.css"  media="all">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/iconcss.css">
<title>账号-账号管理</title>
<style>
    /* .add{
        position: relative;
    }
.add input{
    display: inline-block;
    width:125px;
    height:47px;
    position: absolute;
    top:0;
    left:0;
    opacity: 0;
    filter: Alpha(opacity=0);
    -webkit-filter: Alpha(opacity=0);
} */
.qg_topbar span:nth-of-type(2){
    position: relative;
}
.qg_topbar span:nth-of-type(2) input{
    position: absolute;
    top: 0;
    left: 0;
    display: inline-block;
    width:65px;
    height: 35px;
    opacity: 0;
    filter: Alpha(opacity=0);
    -webkit-filter: Alpha(opacity=0);
}
.layui-input-block{
    margin-left: 0
}
</style>
</head>

<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">
            <img src="images/logo.png" alt="" class="img"/>
        </div>
        <div class="head_right clearfix">
            <div class="top_notice fl">
                <span class="fz">账号管理</span>
                <div class="txt">
                    <li>账号管理可以批量修改，操作，管理账号</li>
                </div>
            </div>
            <div class="top_wz fl">
                <em class="c_blue">567</em>（总使用）/ <em class="c_blue">2000</em>（总端口数）
            </div>
            <div class="fr">
                <a href="#" class="r_fz c_blue">查看登陆日志</a>
                <span class="r_fz">xdqy</span>
                <a href="#" class="r_fz c_blue">修改密码</a>
                <span class="quit quits">退出</span>
            </div>
        </div>
        
    </div> 
    <div class="layui-side left_menu_side">
        <div class="layui-side-scroll">
            <ul class="left_menu">
                <li class="item index">
                    <a href="#">首页</a>
                </li>
                <li class="item account haschild cur">
                    <a href="#">账号</a>
                    <div class="drop">
                        <a href="账号-会员管理.html">会员管理</a>
                        <a href="账号-账号管理.html" class="this">账号管理</a>
                        <a href="账号-账号设置.html">账号设置</a>
                    </div>
                </li>
                <li class="item friend haschild">
                    <a href="#">好友</a>
                    <div class="drop">
                        <a href="好友管理.html">好友管理</a>
                        <a href="好友-加粉任务.html">加粉任务</a>
                        <a href="好友分析.html">好友分析</a>
                    </div>
                </li>
                <li class="item group haschild">
                    <a href="#">群</a>
                    <div class="drop">
                        <a href="#">批量拉群</a>
                        <a href="#">自动群聊</a>
                    </div>
                </li>
                <li class="item function haschild">
                    <a href="#">功能</a>
                    <div class="drop">
                        <a href="功能-群发消息.html">群发消息</a>
                        <a href="功能-发朋友圈.html">群发朋友圈</a>
                        <a href="功能-朋友圈评论.html">朋友圈评论</a>
                        <a href="功能-素材管理.html">素材管理</a>
                    </div>
                </li>
                <li class="item customer haschild">
                    <a href="#">客服系统</a>
                    <div class="drop">
                        <a href="客服-客服管理.html">客服管理</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="layui-body">
        <div class="friend_menu clearfix">
            <li class="item item_1">
                <div class="box">
                    <p class="fz"><img src="images/icon_10.png" alt="" class="ico"/>总数</p>
                    <p class="num">23996</p>
                </div>
                <button class="button">一键全部上线</button>
            </li>
            <li class="item item_2">
                <div class="box">
                    <p class="fz"><img src="images/icon_11.png" alt="" class="ico"/>在线数</p>
                    <p class="num">23996</p>
                </div>
                <button class="button">一键全部导出</button>
            </li>
            <li class="item item_3">
                <div class="box">
                    <p class="fz"><img src="images/icon_12.png" alt="" class="ico"/>离线数</p>
                    <p class="num">23996</p>    
                </div>
                <button class="button">一键全部下线</button>
            </li>
        </div>
        
        <div class="qg_tit">订单详情</div>
        <div class="qg_main bg_white">
            <div class="friend_bar clearfix layui-form friend_bar2">
                <div class="selectbox fl">
                    <select name="" id="">
                        <option value="1">全部账号</option>
                        <option value="2">全部账号</option>
                        <option value="3">全部账号</option>
                    </select>
                </div>
                <div class="selectbox fl">
                    <select name="" id="">
                        <option value="1">全部会员</option>
                        <option value="2">全部会员</option>
                        <option value="3">全部会员</option>
                    </select>
                </div>
                <div class="searchbox fl">
                    <input type="text" class="ipt ipt_txt" placeholder="请输入账号昵称/输入无手机号查询未绑定"/>
                </div>
                <button class="button_ico add fr">添加账号
                    <input type="file" name="files" id="files"  >
                </button>
            </div>

            <div class="friend_tablewrap">
                <div class="qg_topbar">
                    <span class="fz">批量操作（已选<em class="c_blue">0</em>）</span>
                    <span class="button">
                        <input type="file"/> 
                        头像</span>
                    <span class="button addtagBtn">昵称</span>
                    <!-- <button class="button add fr addtagBtn">新建标签</button> -->
                    <span class="button addtagBtn2">修改基本信息</span>
                    <span class="button">备注</span>
                    <span class="button">定位</span>
                    <span class="button">圈封面</span>
                    <span class="button">圈权限</span>
                    <span class="button">删除圈</span>
                    <span class="button">改密</span>
                    <span class="button">改绑</span>
                    <span class="button loginup">上线</span>
                    <span class="button loginout">下线</span>
                    <span class="button del">删除</span>
                </div>
                
                <table class="friend_table layui-form friend_table1 p0">
                    <thead>
                        <th width="3%">
                            <input type="checkbox" name="all" lay-skin="primary" lay-filter="allChoose">
                        </th>
                        <th width="4%">&nbsp;&nbsp;全选</th>
                        <th width="8%">账号名称</th>
                        <th width="8%">账号</th>
                        <th width="5%">等级</th>
                        <th width="5%">性别</th>
                        <th width="5%">二维码</th>
                        <th width="6%">所属会员</th>
                        <th width="5%">地址</th>
                        <th width="5%">实名认证</th>
                        <th width="8%">手机号码</th>
                        <th width="6%">地区</th>
                        <th width="5%">好友数</th>
                        <th width="5%">群数</th>
                        <th width="5%">标签</th>
                        <th width="5%">状态</th>
                        <th width="12%">操作</th>
                    </thead>
                    <tbody>
                        <!-- <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>&nbsp;&nbsp;01</td>
                            <td>
                                <img src="images/icon_14.png"/>
                                小猪佩奇</td>
                            <td>13997467472</td>
                            <td>8</td>
                            <td>男</td>
                            <td>
                                <img src="images/img_01.jpg" alt="" class="qg_vx"/>
                            </td>
                            <td>7.12</td>
                            <td>深圳</td>
                            <td>未验证</td>
                            <td>1366706871</td>
                            <td>--</td>
                            <td>185</td>
                            <td>185</td>
                            <td>1815</td>
                            <td>
                                <em class="status success"></em>
                            </td>
                            <td>
                                <a href="#" class="lk c_blue">重新登录</a>
                                <a href="#" class="lk">登录信息</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>&nbsp;&nbsp;01</td>
                            <td>小猪佩奇</td>
                            <td>13997467472</td>
                            <td>8</td>
                            <td>男</td>
                            <td>
                                <img src="images/img_01.jpg" alt="" class="qg_vx"/>
                            </td>
                            <td>7.12</td>
                            <td>深圳</td>
                            <td>未验证</td>
                            <td>1366706871</td>
                            <td>--</td>
                            <td>185</td>
                            <td>185</td>
                            <td>1815</td>
                            <td>
                                <em class="status fail"></em>
                            </td>
                            <td>
                                <a href="#" class="lk c_blue">重新登录</a>
                                <a href="#" class="lk">登录信息</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>&nbsp;&nbsp;01</td>
                            <td>小猪佩奇</td>
                            <td>13997467472</td>
                            <td>8</td>
                            <td>男</td>
                            <td>
                                <img src="images/img_01.jpg" alt="" class="qg_vx"/>
                            </td>
                            <td>7.12</td>
                            <td>深圳</td>
                            <td>未验证</td>
                            <td>1366706871</td>
                            <td>--</td>
                            <td>185</td>
                            <td>185</td>
                            <td>1815</td>
                            <td>
                                <em class="status success"></em>
                            </td>
                            <td>
                                <a href="#" class="lk c_blue">重新登录</a>
                                <a href="#" class="lk">登录信息</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>&nbsp;&nbsp;01</td>
                            <td>小猪佩奇</td>
                            <td>13997467472</td>
                            <td>8</td>
                            <td>男</td>
                            <td>
                                <img src="images/img_01.jpg" alt="" class="qg_vx"/>
                            </td>
                            <td>7.12</td>
                            <td>深圳</td>
                            <td>未验证</td>
                            <td>1366706871</td>
                            <td>--</td>
                            <td>185</td>
                            <td>185</td>
                            <td>1815</td>
                            <td>
                                <em class="status fail"></em>
                            </td>
                            <td>
                                <a href="#" class="lk c_blue">重新登录</a>
                                <a href="#" class="lk">登录信息</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>&nbsp;&nbsp;01</td>
                            <td>小猪佩奇</td>
                            <td>13997467472</td>
                            <td>8</td>
                            <td>男</td>
                            <td>
                                <img src="images/img_01.jpg" alt="" class="qg_vx"/>
                            </td>
                            <td>7.12</td>
                            <td>深圳</td>
                            <td>未验证</td>
                            <td>1366706871</td>
                            <td>--</td>
                            <td>185</td>
                            <td>185</td>
                            <td>1815</td>
                            <td>
                                <em class="status success"></em>
                            </td>
                            <td>
                                <a href="#" class="lk c_blue">重新登录</a>
                                <a href="#" class="lk">登录信息</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>&nbsp;&nbsp;01</td>
                            <td>小猪佩奇</td>
                            <td>13997467472</td>
                            <td>8</td>
                            <td>男</td>
                            <td>
                                <img src="images/img_01.jpg" alt="" class="qg_vx"/>
                            </td>
                            <td>7.12</td>
                            <td>深圳</td>
                            <td>未验证</td>
                            <td>1366706871</td>
                            <td>--</td>
                            <td>185</td>
                            <td>185</td>
                            <td>1815</td>
                            <td>
                                <em class="status fail"></em>
                            </td>
                            <td>
                                <a href="#" class="lk c_blue">重新登录</a>
                                <a href="#" class="lk">登录信息</a>
                            </td>
                        </tr>  -->
                    </tbody>    
                </table>        
                
                <!--<div class="pagelist">
                    <a href="#" class="active">01</a>
                    <a href="#">02</a>
                    <a href="#">03</a>
                    <a href="#">04</a>
                    <a href="#">05</a>
                    <a href="#">...</a>
                    <a href="#">14</a>
                    <a href="#">15</a>
                    <a href="#">16</a>
                    <span class="next">下一页&gt;</span>
                </div>-->
                <div class="pagelist_wrap">
                    <span class="fz">共144条记录，每页显示</span>
                    <select name="" id="" class="num_box">
                        <option value="">10</option>
                        <option value="">20</option>
                        <option value="">30</option>
                        <option value="">40</option>
                    </select>
                    <div class="pagelist" id="Page">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--修改昵称-->
<div class="pop_bg"></div>
<div class="pop pop_zh pop_hy_addtag pop_hy_addtag1">
    <em class="close">&times;</em>
    <div class="t_tit">修改昵称</div>
    <div class="detail layui-form">
        <div class="box box1">
            <li>
               <input type="text" class="ipt ipt_txt"/>
            </li>
        </div>
        <div class="btns clearfix">
            <button class="button this fl fl1">确定</button>
            <button class="button fr cancel">取消</button>
        </div>
    </div>
</div>

<!--新修改基本信息-->
<div class="pop pop_zh pop_hy_addtag pop_hy_addtag2">
    <em class="close">&times;</em>
    <div class="t_tit">修改基本信息</div>
    <div class="detail layui-form">
        <div class="box box2 layui-form-item">
            <li class="layui-input-block">
                <select class="form-control input-sm" name="category" lay-filter="category" aria-invalid="false">
                    <option value=""></option>
                    <option value="0">男</option>
                    <option value="1">女</option>
                </select>
            </li>
        </div>
        <div class="box box3">
                <li>
                   <input type="text" class="ipt ipt_txt" placeholder="请输入省份"/>
                </li>
            </div>
            <div class="box box4">
                    <li>
                       <input type="text" class="ipt ipt_txt" placeholder="请输入城市"/>
                    </li>
                </div>
            <div class="box box5">
                    <li>
                       <input type="text" class="ipt ipt_txt" placeholder="修改个性签名"/>
                    </li>
                </div>
        <div class="btns clearfix">
            <button class="button this fl fl2">确定</button>
            <button class="button fr cancel">取消</button>
        </div>
    </div>
</div>



<script src="js/jquery-1.8.3.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="layui/layui.js" charset="utf-8"></script>
<script src="js/common.js" charset="utf-8"></script>
<script src="js/addcount.js"></script>
<script src="js/accountmanage.js"></script>
<script src="js/loginout.js"></script>
<script src="js/norepeat.js"></script>
<script>
layui.use(["layer",'form', 'upload', 'laydate'], function(){
var form = layui.form
,layer = layui.layer
,layedit = layui.layedit
,laydate = layui.laydate
,upload = layui.upload;

form.on('select(category)', function (data) {
          category = data.value;
          categoryName = data.elem[data.elem.selectedIndex].text;
          console.log(categoryName)
          form.render('select');
        });
  
token = localStorage.getItem("token")
    //console.log(token)
    var data =
        '{"type":' +
        '"get_account_list",' +
        '"state":' +
        '"all",' +
        '"limit_start":' +
        '"'+0+'",' +
        '"limit_end":' +
        '"'+20+'",' +
        '"ticket":' +
        '"'+token+'"' +
        '}'
        //传入参数
        //console.log(data)
        //获取账号列表
        $.ajax({
            type: 'post',
            url: 'http://192.168.10.177/api.esp',
            data:data,
            dataType: 'json',
            success:function(msg){
                if(msg.err_code == 0){
                    console.log(msg.data)
                    var data = msg.data
                    // localStorage.setItem("wxid_raw",msg.data[0].wxid_raw)
                    // localStorage.setItem("weixinnick",)
                    var str = "";
                    var ind = 0
                    var wx_raw = []
                    var wx_nick = []
                    var lablegroup = []
                    for(var id in data){
                        //微信号
                        // if(data[id].wxid_raw != "" || data[id].nick != ""){
                        //     wx_raw.push(data[id].wxid_raw)
                        //     wx_raw = norepeat(wx_raw)
                        //     localStorage.setItem("wxid_raw",JSON.stringify(wx_raw))

                        //     //微信昵称
                        //     wx_nick.push(data[id].nick)
                        //     wx_nick = norepeat(wx_nick)
                        //     localStorage.setItem("weixinnick",JSON.stringify(wx_nick))
                        // }
                        

                        lablegroup.push(data[id].lable)
                        var lablegroup =  norepeat(lablegroup)
                        localStorage.setItem("lablegroup",JSON.stringify(lablegroup))
                        ind ++;
                        ind = ind < 10 ? "0" + ind : ind
                        str += `
                        <tr data-id=${data[id].id}>
                            <td>
                                <input data-id=${data[id].id} type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>&nbsp;&nbsp;${ind}</td>
                            <td>
                                <img src="${data[id].head_img}" style="width:30px;height:30px;border-radius:50%" data-lable=${data[id].lable} data-phone=${data[id].phone} data-id=${data[id].id} data-nick=${data[id].nick} data-sex=${data[id].sex} data-city=${data[id].sex} data-sign=${data[id].sign_str}>
                                ${data[id].nick}
                            </td>
                            <td>${data[id].wxid_raw}</td>
                            <td>8</td>
                            <td>${data[id].sex}</td>
                            <td>
                                <img src="images/img_01.jpg" alt="" class="qg_vx"/>
                            </td>
                            <td>7.12</td>
                            <td>深圳</td>
                            <td>未验证</td>
                            <td>${data[id].phone}</td>
                            <td>--</td>
                            <td>185</td>
                            <td>185</td>
                            <td>${data[id].lable}</td>
                            <td>
                            <em class="status success"></em>
                            </td>
                            <td>
                                <a href="#" class="lk c_blue c_blues" data-id=${data[id].id}>重新登录</a>
                                <a href="#" class="lk">登录信息</a>
                            </td>
                        </tr>
                        `
                    }
                    $("table tbody").append(str)
                    form.render('checkbox');
                }
            },
            error:function(err){
                console.log(err)
            }
        })
  

 
var count = 0
  form.on('checkbox(allChoose)', function(data){
      //点击全选后的所有的tr元素
    var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
    //console.log(child)
    var imgArr = []

    var total = $(data.elem).parents('table').find('tbody input[type="checkbox"]').length;
    //console.log(total,nototal)
    count++;
    if(count%2 !== 0){
        console.log("全选")
        $(".qg_topbar span:first-child").find("em").text(total)

    }else{
        console.log("全不选")
        $(".qg_topbar span:first-child").find("em").text(0)
    }
    //点击全选的时候批量操作总量
    $(".qg_topbar span:first-child").find("em").text(total)
    child.each(function(index, item){
        
        imgArr.push($(item).parents("tr").find("td:nth-of-type(3) img").get(0))
        
        item.checked = data.elem.checked;
    });
    form.render('checkbox');
    for(let i = 0; i < imgArr.length; i++){
        let id = imgArr[i].getAttribute("data-id")
        let imgSrc = imgArr[i].src
        window.imgSrc = imgSrc
        let sexAll = imgArr[i].getAttribute("data-sex")
        let cityAll = imgArr[i].getAttribute("data-city")
        let signAll = imgArr[i].getAttribute("data-sign")
        let nickAll = imgArr[i].getAttribute("data-nick")
        let lableAll = imgArr[i].getAttribute("data-lable")
        let phoneAll = imgArr[i].getAttribute("data-phone")
        //console.log(id,sexAll,cityAll,signAll,nickAll,lableAll,phoneAll)
        
        //上传头像
        $(".qg_topbar span:nth-of-type(2) input").change(function(){
            //循环出来的id和src
            //console.log(id,imgSrc)
            var file = document.querySelector('.qg_topbar span:nth-of-type(2) input[type=file]').files[0];
            var reader  = new FileReader();
            reader.addEventListener("load", function () {
                imgSrc.src = reader.result;
                var baseimg = reader.result
                //console.log(baseimg)

                //token
                var token = localStorage.getItem("token")
                //传入参数
                var data =
                '{"type":' +
                '"change_head",' +
                '"id":' +
                '"'+id+'",' +
                '"head_img":' +
                '"'+baseimg+'",' +
                '"ticket":' +
                '"'+token+'"' +
                '}'
                console.log(data)
                $.ajax({
                    type: 'post',
                    url: 'http://192.168.10.177/api.esp',
                    data:data,
                    dataType: 'text',
                    success:function(msg){
                        console.log(msg)
                        // if(msg.err_code == 0){
                        //     console.log(msg.data)
                        // }
                    },
                    error:function(err){
                        console.log(err)
                    }
                })
            }, false);

            if (file) {
                reader.readAsDataURL(file);
            }
        })
        
        //全选上线
        $(".loginup").click(function(){
            var data =
            '{"type":' +
            '"login_account",' +
            '"id":' +
            '"'+id+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        layer.msg("已提交登录")
                    }else{
                        layer.msg("登录失败")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })
    
        //全选下线
        $(".loginout").click(function(){
            var data =
            '{"type":' +
            '"logout_account",' +
            '"id":' +
            '"'+id+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        layer.msg("下线成功")
                    }else{
                        layer.msg("操作失败")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })
    
    
        //全选删除
        $(".del").click(function(){
            var data =
            '{"type":' +
            '"del_account",' +
            '"lable":' +
            '"group1",' +
            '"phone":' +
            '"'+phoneAll+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        layer.msg("删除成功")
                    }else{
                        layer.msg("删除失败")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })
    
    
        //全选修改昵称
        $(".btns .fl1").click(function(){
            var $nick = $(".box1 .ipt_txt").val()
            var data =
            '{"type":' +
            '"change_nick",' +
            '"id":' +
            '"'+id+'",' +
            '"nick":' +
            '"'+$nick+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        $('.pop_hy_addtag1').hide();
                        $('.pop_bg').hide();
                        layer.msg("修改成功")
                    }else{
                        layer.msg("修改失败")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })
   
           //修改个人信息
        $(".btns .fl2").click(function(){
            console.log(categoryName)
            var $province = $(".box3 .ipt_txt").val()
            var $cityAll = $(".box4 .ipt_txt").val()
            var $signAll = $(".box5 .ipt_txt").val()
            $sexAll = categoryName == "男" ? 1 : 2
            //console.log($cityOneAll,$signOneAll,$sexOneAll)
            var data =
            '{"type":' +
            '"change_info",' +
            '"id":' +
            '"'+id+'",' +
            '"sex":' +
            '"'+$sexAll+'",' +
            '"province":' +
            '"'+$province+'",' +
            '"city":' +
            '"'+$cityAll+'",' +
            '"sign_str":' +
            '"'+$signAll+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        $('.pop_hy_addtag2').hide();
                        $('.pop_bg').hide();
                        layer.msg("修改成功")
                    }else{
                        layer.msg("修改失败")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })

    }
});

//单选
form.on('checkbox(itemChoose)',function(data){
    var arrOne = []
    var imgOneAll = $(data.elem).parents('table').find('tbody input[type="checkbox"]:checked')
    console.log(imgOneAll)
    imgOneAll.each(function(index,item){
        arrOne.push($(item).parents("tr").find("td:nth-of-type(3) img").get(0))
    })
    for(let i = 0; i < arrOne.length; i++){
        let idOneAll = arrOne[i].getAttribute("data-id")
        let imgSrcOneAll = arrOne[i].src
        let sexOneAll = arrOne[i].getAttribute("data-sex")
        let cityOneAll = arrOne[i].getAttribute("data-city")
        let signOneAll = arrOne[i].getAttribute("data-sign")
        let nickOneAll = arrOne[i].getAttribute("data-nick")
        let lableOneAll = arrOne[i].getAttribute("data-lable")
        let phoneOneAll = arrOne[i].getAttribute("data-phone")
        //console.log(lableOneAll,sexOneAll,cityOneAll,signOneAll,nickOneAll,lableOneAll,phoneOneAll)
        //上传图片
        $(".qg_topbar span:nth-of-type(2) input").change(function(){
            
                //循环出来的id和src
                console.log(idOneAll,imgSrcOneAll)
                var file = document.querySelector('.qg_topbar span:nth-of-type(2) input[type=file]').files[0];
                var reader  = new FileReader();
                reader.addEventListener("load", function () {
                    imgSrcOneAll = reader.result;
                    var baseimg = reader.result
                    console.log(baseimg)
    
                    //token
                    var token = localStorage.getItem("token")
                    //传入参数
                    var data =
                    '{"type":' +
                    '"change_head",' +
                    '"id":' +
                    '"'+idOneAll+'",' +
                    '"head_img":' +
                    '"'+baseimg+'",' +
                    '"ticket":' +
                    '"'+token+'"' +
                    '}'
                    //console.log(data)
                    $.ajax({
                        type: 'post',
                        url: 'http://192.168.10.177/api.esp',
                        data:data,
                        dataType: 'text',
                        success:function(msg){
                            console.log(msg)
                            // if(msg.err_code == 0){
                            //     console.log(msg.data)
                            // }
                        },
                        error:function(err){
                            console.log(err)
                        }
                    })
                }, false);
    
                if (file) {
                    reader.readAsDataURL(file);
                }
            })
        

             //修改昵称
        $(".btns .fl1").click(function(){
            var $nick = $(".box1 .ipt_txt").val()
            var data =
            '{"type":' +
            '"change_nick",' +
            '"id":' +
            '"'+idOneAll+'",' +
            '"nick":' +
            '"'+$nick+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        $('.pop_hy_addtag1').hide();
                        $('.pop_bg').hide();
                        layer.msg("修改成功")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })


        //修改个人信息
        $(".btns .fl2").click(function(){
            console.log(categoryName)
            var $province = $(".box3 .ipt_txt").val()
            var $cityOneAll = $(".box4 .ipt_txt").val()
            var $signOneAll = $(".box5 .ipt_txt").val()
            $sexOneAll = categoryName == "男" ? 1 : 2
            //console.log($cityOneAll,$signOneAll,$sexOneAll)
            var data =
            '{"type":' +
            '"change_info",' +
            '"id":' +
            '"'+idOneAll+'",' +
            '"sex":' +
            '"'+$sexOneAll+'",' +
            '"province":' +
            '"'+$province+'",' +
            '"city":' +
            '"'+$cityOneAll+'",' +
            '"sign_str":' +
            '"'+$signOneAll+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            //console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        $('.pop_hy_addtag2').hide();
                        $('.pop_bg').hide();
                        layer.msg("修改成功")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })

        //重新登录
        $("body").delegate(".c_blues","click",function(){
            var data =
            '{"type":' +
            '"login_account",' +
            '"id":' +
            '"'+idOneAll+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            // console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        layer.msg("已提交登录")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })

        //上线
        $(".loginup").click(function(){
            var data =
            '{"type":' +
            '"login_account",' +
            '"id":' +
            '"'+idOneAll+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            //console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        layer.msg("已提交登录")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })


        //下线
        $(".loginout").click(function(){
            var data =
            '{"type":' +
            '"logout_account",' +
            '"id":' +
            '"'+idOneAll+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            //console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        layer.msg("下线成功")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })

        //删除
        $(".del").click(function(){
            var data =
            '{"type":' +
            '"del_account",' +
            '"lable":' +
            '"'+lableOneAll+'",' +
            '"phone":' +
            '"'+phoneOneAll+'",' +
            '"ticket":' +
            '"'+token+'"' +
            '}'
            //console.log(data)
            $.ajax({
                type: 'post',
                url: 'http://192.168.10.177/api.esp',
                data:data,
                dataType: 'json',
                success:function(msg){
                    console.log(msg)
                    if(msg.err_code == 0){
                        layer.msg("删除成功")
                    }
                },
                error:function(err){
                    console.log(err)
                }
            })
        })
        }

   



    //单选选中的数量
    var sib = $(data.elem).parents('table').find('tbody input[type="checkbox"]:checked').length;
    
    $(".qg_topbar span:first-child").find("em").text(sib)
    //总共的数量
    var total = $(data.elem).parents('table').find('tbody input[type="checkbox"]').length;
    if(sib == total){
        $(data.elem).parents('table').find('thead input[type="checkbox"]').prop("checked",true);
        form.render();
    }else{
        $(data.elem).parents('table').find('thead input[type="checkbox"]').prop("checked",false);
        form.render();
    }
});

$('.addtagBtn').click(function(){
    $('.pop_hy_addtag1').show();
    $('.pop_bg').show();
});

$('.addtagBtn2').click(function(){
    $('.pop_hy_addtag2').show();
    $('.pop_bg').show();
    
});

});

</script>
<script type="text/javascript" src="js/mypage.js"></script>
<script type="text/javascript">
    P.initMathod({
        params: {elemId: '#Page',total:'123'},
        requestFunction: function () {
           // P.config.total = parseInt(Math.random() * 10 + 85);//此处模拟总记录变化

            //TODO ajax异步请求过程,异步获取到的数据总条数赋值给 P.config.total
            
            //列表渲染自行处理
            
            console.log(JSON.stringify(P.config));
        }
    });
</script>
</body>
</html>
