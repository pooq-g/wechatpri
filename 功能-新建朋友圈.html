<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="layui/css/layui.css" media="all" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/ullist.css">
    <title>群管-新建朋友圈</title>
    <style>
      .upload-pick {
        position: relative;
      }
      .upload-pick input {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        opacity: 0;
        filter: Alpha(opacity=0);
        -webkit-filter: Alpha(opacity=0);
      }
    </style>
  </head>

  <body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
      <div class="layui-header">
        <div class="layui-logo">
          <img src="images/logo.png" alt="" class="img" />
        </div>
        <div class="head_right clearfix">
          <div class="top_notice fl">
            <span class="fz">发朋友圈</span>
            <div class="txt">
              <li>这里是功能介绍这里是功能介绍这里是功能介绍</li>
            </div>
          </div>
          <div class="fr">
            <a href="#" class="r_fz c_blue">查看登陆日志</a>
            <span class="r_fz">xdqy</span>
            <a href="#" class="r_fz c_blue">修改密码</a>
            <span class="quit quits">退出</span>
          </div>
        </div>
      </div>
      <div class="layui-side left_menu_side">
        <div class="layui-side-scroll">
          <ul class="left_menu">
            <li class="item index">
              <a href="#">首页</a>
            </li>
            <li class="item account haschild">
              <a href="#">账号</a>
              <div class="drop">
                <a href="账号-会员管理.html">会员管理</a>
                <a href="账号-账号管理.html">账号管理</a>
                <a href="账号-账号设置.html">账号设置</a>
              </div>
            </li>
            <li class="item friend haschild">
              <a href="#">好友</a>
              <div class="drop">
                <a href="好友管理.html">好友管理</a>
                <a href="好友-加粉任务.html">加粉任务</a>
                <a href="好友分析.html">好友分析</a>
              </div>
            </li>
            <li class="item group haschild">
              <a href="#">群</a>
              <div class="drop">
                <a href="群管-拉群任务.html">批量拉群</a>
                <a href="群管-加群聊天.html">自动群聊</a>
              </div>
            </li>
            <li class="item function haschild cur">
              <a href="#">功能</a>
              <div class="drop">
                <a href="功能-群发消息.html">群发消息</a>
                <a href="功能-发朋友圈.html">群发朋友圈</a>
                <a href="功能-朋友圈评论.html">朋友圈评论</a>
                <a href="功能-素材管理.html">素材管理</a>
                <a href="#">群发群</a>
              </div>
            </li>
            <li class="item customer haschild">
              <a href="#">客服系统</a>
              <div class="drop">
                <a href="客服-客服管理.html">客服管理</a>
                <a href="客服-聊天设置.html">聊天设置</a>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="layui-body">
        <div class="friend_bar layui-form">
          <li class="item">
            <a href="javascript:;" class="anniu adduserBtn adduserBtn2"
              >选择发布类型</a
            >
          </li>
          <li class="item">
            <a href="javascript:;" class="anniu adduserBtn adduserBtn1"
              >+添加分组设置</a
            >
          </li>
        </div>
        <div class="qg_tit">发布内容</div>
        <div class="qg_main bg_white layui-form">
          <div class="friend_text" style="position: relative">
            <textarea
              name=""
              class="ipt textarea textarea1"
              placeholder="说说你的想法吧。。。"
            ></textarea>
            <div
              class="positiemoij"
              style="width: 512px;position: absolute;left:0;top: 0;display: none;"
            >
              <div
                class="expression expression1 one"
                style="background: #fff !important"
              >
                <div class="scroll-wrapper">
                  <div class="face-tb">
                    <ul></ul>
                  </div>
                </div>
              </div>

              <div
                class="expression expression2"
                style="width: 736px;background: #fff !important"
              >
                <div class="scroll-wrapper">
                  <div class="face-tb">
                    <ul></ul>
                  </div>
                </div>
              </div>
              <ul class="nextemoij" style="bottom: -301px">
                <li>1</li>
                <li>2</li>
              </ul>
            </div>
            <div class="bar">
              <span class="bq"></span>
              <span class="words fr">0/1000</span>
            </div>
          </div>
          <div class="friend_type">
            <h6 class="friend_tit">类型</h6>
            <div class="radio_group">
              <div class="grp">
                <input
                  type="radio"
                  name="type"
                  value="图片"
                  title="图片"
                  checked=""
                  lay-filter="pic"
                />
              </div>
              <div class="grp">
                <input
                  type="radio"
                  name="type"
                  value="链接"
                  title="链接"
                  lay-filter="pic"
                />
              </div>
            </div>
            <div class="fileup_box">
              <ul class="upload-ul clearfix">
                <li class="upload-pick">
                  <input type="file" />
                </li>
              </ul>
            </div>
          </div>
          <div class="friend_comment">
            <h6 class="friend_tit">自己朋友圈评论设置</h6>

            <p class="fz">评论（可多选）</p>
            <textarea
              name=""
              class="ipt textarea textarea2"
              placeholder="请输入评论，多条评论请用；分隔"
            ></textarea>
          </div>
          <div class="friend_btns">
            <button class="button this fastsend">立即发布</button>
            <button class="button">定时发布</button>
          </div>
        </div>
      </div>
    </div>

    <!--添加账号-弹窗-->
    <div class="pop_bg"></div>
    <div class="pop pop_zh pop_qg_adduser">
      <em class="close">&times;</em>
      <div class="t_tit">添加账号</div>
      <div class="detail layui-form">
        <div class="searchbox clearfix">
          <input
            type="text"
            class="ipt ipt_txt fl"
            placeholder="请输入关键词搜索"
          />
          <input type="button" class="ipt ipt_button fr" value="搜索" />
        </div>
        <div class="box clearfix">
          <div class="box_l fl">
            <div class="topbar"><em class="fz fl">全选</em>全部账号</div>
            <div class="bottom">
              <li>
                <input
                  type="checkbox"
                  name="like1[write]"
                  lay-skin="primary"
                  title=""
                />7.12-(83)
              </li>
              <li>
                <input
                  type="checkbox"
                  name="like1[write]"
                  lay-skin="primary"
                  title=""
                />7.12-(83)
              </li>
              <li>
                <input
                  type="checkbox"
                  name="like1[write]"
                  lay-skin="primary"
                  title=""
                />7.12-(83)
              </li>
            </div>
          </div>
          <div class="box_r fr">
            <div class="topbar">已选账号<em class="fz fr">清空</em></div>
            <div class="bottom">
              <li>安琪<em class="delete"></em></li>
              <li>安琪<em class="delete"></em></li>
              <li>安琪<em class="delete"></em></li>
              <li>安琪<em class="delete"></em></li>
              <li>安琪<em class="delete"></em></li>
              <li>安琪<em class="delete"></em></li>
              <li>安琪<em class="delete"></em></li>
            </div>
          </div>
        </div>
        <div class="tips">当前已选账号83个</div>
        <div class="btns clearfix">
          <button class="button this">确定</button>
          <button class="button cancel">取消</button>
        </div>
      </div>
    </div>

    <!--选择发布类型-->
    <div class="pop pop_zh pop_hy_addtag pop_hy_addtag2">
      <em class="close">&times;</em>
      <div class="t_tit">修改基本信息</div>
      <div class="detail layui-form">
        <div class="box box2 layui-form-item">
          <li class="layui-input-block" style="margin-left: 0">
            <select
              class="form-control input-sm"
              name="categorys"
              lay-filter="categorys"
              aria-invalid="false"
            >
              <option value=""></option>
              <option value="1">图文</option>
              <option value="2">文字</option>
              <option value="3" disabled>转发文章</option>
              <option value="7">更换背景图</option>
              <option value="15">视频</option>
            </select>
          </li>
        </div>
        <div class="btns clearfix">
          <button class="button this fl fl21">确定</button>
          <button class="button fr cancel">取消</button>
        </div>
      </div>
    </div>

    <!--新修改基本信息-->
    <div class="pop pop_zh pop_hy_addtag pop_hy_addtag3">
      <em class="close">&times;</em>
      <div class="t_tit">请输入链接</div>
      <div class="detail layui-form">
        <div class="box box3">
          <li>
            <input type="text" class="ipt ipt_txt ipt_txtlink" placeholder="请输入链接" />
          </li>
        </div>
        <div class="btns clearfix">
          <button class="button this fl fl2">确定</button>
          <button class="button fr cancel">取消</button>
        </div>
      </div>
    </div>

    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="layui/layui.js" charset="utf-8"></script>
    <script src="js/common.js" charset="utf-8"></script>
    <script src="js/loginout.js"></script>
    <script src="js/face.js"></script>
    <script>
      layui.use(['form', 'upload', 'laydate'], function() {
        var form = layui.form,
          layer = layui.layer,
          layedit = layui.layedit,
          laydate = layui.laydate,
          upload = layui.upload

        token = localStorage.getItem('token')
        wxid_raw = JSON.parse(localStorage.getItem('wxid_raw'))

        //1.选择要发布的类型
        form.on('select(categorys)', function(data) {
          categorys = data.value
          form.render('select')
          localStorage.setItem('mm_post', categorys)
        })

        //1.动态添加要发布的账号
        // var str = ''
        // var count = 1
        // for (var i in wxid_raw) {
        //   count++
        //   str += `
        //   <option value="${count}">${wxid_raw[i]}</option>
        //   `
        // }
        // $('select').append(str)
        // form.render()

        //2.选择发布账号(选择分组)
        form.on('select(category)', function(data) {
          category = data.value
          categoryName = data.elem[data.elem.selectedIndex].text
          console.log(categoryName)
          form.render('select')
        })

        //3.输入文字表情包
        var count = 0
        $('.bq').click(function() {
          count++
          if (count % 2 == 0) {
            $('.positiemoij').hide()
          } else {
            $('.positiemoij').show()
          }
          var content = $('.textarea1').val()

          //输入表情
          $('.positiemoij>.expression li').click(function() {
            console.log(content)
            var name = $(this)
              .find('i')
              .get(0)
              .getAttribute('data-name')
            $('.positiemoij').hide()
            //$content += $(".ipt").val("["+name+"]")
            content += '[' + name + ']'

            console.log(content)
            $('.textarea1').val(content)
          })
        })

        //发送图片
        $('.upload-pick input').change(function() {
          var file = document.querySelector('.upload-pick input[type=file]')
            .files[0]
          var reader = new FileReader()
          var imgUrlBase64
          if (file) {
            imgUrlBase64 = reader.readAsDataURL(file)
            reader.onload = function() {
              baseimg = reader.result
              //console.log(baseimg)
              localStorage.setItem("baseimg",baseimg)
            //   for (var i in wxid_raw) {
            //     var data =
            //       '{"type":' +
            //       '"mm_post",' +
            //       '"wxid":' +
            //       '"' +
            //       wxid_raw[i] +
            //       '",' +
            //       '"content":' +
            //       '"' +
            //       $('.textarea1').val() +
            //       '",' +
            //       '"img":' +
            //       '"' +
            //       baseimg +
            //       '",' +
            //       '"ticket":' +
            //       '"' +
            //       token +
            //       '"' +
            //       '}'
            //     console.log(data)
            //     $.ajax({
            //       type: 'post',
            //       url: 'http://192.168.10.177/api.esp',
            //       data: data,
            //       dataType: 'json',
            //       success: function(msg) {
            //         console.log(msg)
            //         if (msg.err_code == 0) {
            //           layer.msg('发布成功')
            //         } else {
            //           layer.msg('发布成功')
            //         }
            //       },
            //       error: function(err) {
            //         console.log(err)
            //       }
            //     })
            //   }
             }
          }
        })

        //选择发送的类型是图片还是链接
        form.on('radio(pic)', function(data) {
          console.log(data.value)
          if(data.value == "链接"){
            $('.pop_hy_addtag3').show()
            $('.pop_bg').show()
          }
        })

        //把要添加的链接添加在页面上
        var str = ""
        $(".fl2").click(function(){
          var $link = $(".ipt_txtlink").val()
          str = `
             <li>
                     <div class="details" data-msgtype="text">
                       <div class="text">${$link}</div>
                   </li>
             `
             $(".friend_type").append(str)
             $('.pop_hy_addtag3').hide()
              $('.pop_bg').hide()
        })

        //选择发品论提醒设置
        form.on('radio(comment)', function(data) {
          console.log(data.value)
        })

  

       $(".fastsend").click(function(){
        var mm_post = localStorage.getItem("mm_post")
        var baseimg = localStorage.getItem("baseimg")
        console.log(mm_post)
        console.log($('.textarea1').val())
        console.log($(".friend_type").find('.text')
          .html())
          var $link = $(".friend_type").find('.text')
          .html()

          //判断发送的类型
          if(mm_post == 1){
            for (var i in wxid_raw) {
            var data =
                  '{"type":' +
                  '"mm_post",' +
                  '"wxid":' +
                  '"' +
                  wxid_raw[i] +
                  '",' +
                  '"content_style":' +
                  '"' +
                  mm_post +
                  '",' +
                  '"img":' +
                  '"' +
                  baseimg +
                  '",' +
                  '"content":' +
                  '"' +
                  $('.textarea1').val() +
                  '",' +
                  '"ticket":' +
                  '"' +
                  token +
                  '"' +
                  '}'
                console.log(data)
                $.ajax({
                  type: 'post',
                  url: 'http://192.168.10.177/api.esp',
                  data: data,
                  dataType: 'json',
                  success: function(msg) {
                    console.log(msg)
                    if (msg.err_code == 0) {
                      layer.msg('上传成功')
                    } else {
                      layer.msg('上传失败')
                    }
                  },
                  error: function(err) {
                    console.log(err)
                  }
                })
            }
          }else if(mm_post == 2){
            //文字
            for (var i in wxid_raw) {
            var data =
                  '{"type":' +
                  '"mm_post",' +
                  '"wxid":' +
                  '"' +
                  wxid_raw[i] +
                  '",' +
                  '"content_style":' +
                  '"' +
                  mm_post +
                  '",' +
                  '"content":' +
                  '"' +
                  $('.textarea1').val() +
                  '",' +
                  '"ticket":' +
                  '"' +
                  token +
                  '"' +
                  '}'
                console.log(data)
                $.ajax({
                  type: 'post',
                  url: 'http://192.168.10.177/api.esp',
                  data: data,
                  dataType: 'json',
                  success: function(msg) {
                    console.log(msg)
                    if (msg.err_code == 0) {
                      layer.msg('上传成功')
                    } else {
                      layer.msg('上传失败')
                    }
                  },
                  error: function(err) {
                    console.log(err)
                  }
                })
            }
          }else if(mm_post == 3){
            console.log("转发文章")
          }else if(mm_post == 7){
            //更换背景图
            for (var i in wxid_raw) {
            var data =
                  '{"type":' +
                  '"mm_post",' +
                  '"wxid":' +
                  '"' +
                  wxid_raw[i] +
                  '",' +
                  '"content_style":' +
                  '"' +
                  mm_post +
                  '",' +
                  '"img":' +
                  '"' +
                  baseimg +
                  '",' +
                  '"content":' +
                  '"' +
                  $('.textarea1').val() +
                  '",' +
                  '"ticket":' +
                  '"' +
                  token +
                  '"' +
                  '}'
                console.log(data)
                $.ajax({
                  type: 'post',
                  url: 'http://192.168.10.177/api.esp',
                  data: data,
                  dataType: 'json',
                  success: function(msg) {
                    console.log(msg)
                    if (msg.err_code == 0) {
                      layer.msg('上传成功')
                    } else {
                      layer.msg('上传失败')
                    }
                  },
                  error: function(err) {
                    console.log(err)
                  }
                })
            }
          }else if(mm_post == 15){
            for (var i in wxid_raw) {
            var data =
                  '{"type":' +
                  '"mm_post",' +
                  '"wxid":' +
                  '"' +
                  wxid_raw[i] +
                  '",' +
                  '"content_style":' +
                  '"' +
                  mm_post +
                  '",' +
                  '"img":' +
                  '"' +
                  baseimg +
                  '",' +
                  '"videourl":' +
                  '"' +
                  $link +
                  '",' +
                  '"content":' +
                  '"' +
                  $('.textarea1').val() +
                  '",' +
                  '"ticket":' +
                  '"' +
                  token +
                  '"' +
                  '}'
                console.log(data)
                $.ajax({
                  type: 'post',
                  url: 'http://192.168.10.177/api.esp',
                  data: data,
                  dataType: 'json',
                  success: function(msg) {
                    console.log(msg)
                    if (msg.err_code == 0) {
                      layer.msg('上传成功')
                    } else {
                      layer.msg('上传失败')
                    }
                  },
                  error: function(err) {
                    console.log(err)
                  }
                })
            }
          }
       })
      })
    </script>
    <script src="js/webuploader.min.js"></script>
    <script src="js/diyUpload.js"></script>
    <script>
    

      //控制输入的文字数量
      $('body').delegate('.ipt', 'propertychange input', function() {
        if ($(this).length > 0) {
          var $len = $(this).val().length
          var $inputlen = 1000 - $len
          $('.words').html($inputlen + '/1000')
          if ($len >= 1000) {
            $(this).val(
              $(this)
                .val()
                .substring(0, 1000)
            )
            $('.words').html(0)
          }
        } else {
          console.log('未输入')
        }
      })

      //点击出来分组
      $('.adduserBtn1').click(function() {
        $('.pop_qg_adduser').show()
        $('.pop_bg').show()
      })

      //点击选择要发布的类型
      $('.adduserBtn2').click(function() {
        $('.pop_hy_addtag2').show()
        $('.pop_bg').show()
      })

      //点击选择发布的类型关闭
      $(".fl21").click(function(){
        $('.pop_hy_addtag2').hide()
        $('.pop_bg').hide()
      })

      $('.positiemoij>ul li').click(function() {
        var $ind = $(this).text() - 1
        console.log($ind)
        $('.expression')
          .eq($ind)
          .addClass('one')
          .siblings()
          .removeClass('one')
      })
    </script>
  </body>
</html>
