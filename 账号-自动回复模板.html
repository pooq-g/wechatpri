<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="layui/css/layui.css" media="all" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/ullist.css" />
    <title>账号-自动回复模板</title>
  </head>

  <body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
      <div class="layui-header">
        <div class="layui-logo">
          <img src="images/logo.png" alt="" class="img" />
        </div>
        <div class="head_right clearfix">
          <div class="top_notice fl">
            <span class="fz">打招呼模板列表</span>
            <div class="txt">
              <li>这里是功能介绍这里是功能介绍这里是功能介绍</li>
            </div>
          </div>
          <!--<div class="top_wz fl">
                <em class="c_blue">567</em>（总使用）/ <em class="c_blue">2000</em>（总端口数）
            </div>-->
          <div class="fr">
            <a href="#" class="r_fz c_blue">查看登陆日志</a>
            <span class="r_fz">xdqy</span>
            <a href="#" class="r_fz c_blue">修改密码</a>
            <span class="quit quits">退出</span>
          </div>
        </div>
      </div>
      <div class="layui-side left_menu_side">
        <div class="layui-side-scroll">
          <ul class="left_menu">
            <li class="item index">
              <a href="#">首页</a>
            </li>
            <li class="item account haschild cur">
              <a href="#">账号</a>
              <div class="drop">
                <a href="账号-会员管理.html">分组管理</a>
                <a href="账号-账号管理.html">账号管理</a>
                <a href="账号-账号设置.html">账号设置</a>
              </div>
            </li>
            <li class="item friend haschild">
              <a href="#">好友</a>
              <div class="drop">
                <a href="好友管理.html">好友管理</a>
                <a href="好友-加粉任务.html">加粉任务</a>
                <a href="好友分析.html">好友分析</a>
              </div>
            </li>
            <li class="item group haschild">
              <a href="#">群</a>
              <div class="drop">
                <a href="群管-拉群任务.html">批量拉群</a>
                <a href="群管-新建群聊.html">自动群聊</a>
              </div>
            </li>
            <li class="item function haschild">
              <a href="#">功能</a>
              <div class="drop">
                <a href="功能-群发消息.html">群发消息</a>
                <a href="功能-发朋友圈.html">群发朋友圈</a>
                <a href="功能-朋友圈评论.html">朋友圈评论</a>
                <a href="功能-素材管理.html">素材管理</a>
                <a href="#">群发群</a>
              </div>
            </li>
            <li class="item customer haschild">
              <a href="#">客服系统</a>
              <div class="drop">
                <a href="客服-客服管理.html">客服管理</a>
                <a href="客服-聊天设置.html">聊天设置</a>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="layui-body">
        <div class="bd_wrap bg_white">
          <div class="friend_bar clearfix layui-form bg_f4">
            <li class="item_group clearfix fl">
              <span class="fz fl">模板名称</span>
              <div class="searchbox fl">
                <input
                  type="text"
                  class="ipt ipt_txt searchmuban"
                  placeholder="请输入模板名称（最多20字）"
                />
              </div>
            </li>
            <li class="item_group clearfix fl">
              <span class="fz fl">关键词</span>
              <div class="searchbox fl">
                <input
                  type="text"
                  class="ipt ipt_txt searchkj"
                  placeholder="请输入关键字（最多20字）"
                  required
                />
              </div>
            </li>
            <li class="item_group clearfix fl">
              <div class="apply">
                <input
                  type="radio"
                  name="apply"
                  value="1"
                  title="仅第一次回复"
                  lay-filter="firstcall"
                />
              </div>
            </li>
            <li class="item_group clearfix fl">
              <div class="apply">
                <input
                  type="radio"
                  name="apply"
                  value="2"
                  title="可多次回复"
                  lay-filter="firstcall"
                />
              </div>
            </li>
            <button class="button_ico backlist fr">返回列表</button>
          </div>
          <div class="qg_tit">模板内容</div>
          <div class="template_main">
            <div class="template_bar">
              <span class="lk txt txts">文字</span>
              <!-- <span class="lk pics">图片</span>
              <span class="lk voice">语音</span>
              <span class="lk link">链接</span> -->
            </div>
            <ul class="template_bar msg-list" style="padding:22px"></ul>
            <!-- <div class="template_fz">
              文字（<em class="c_blue">0</em>）、图片（<em class="c_blue">0</em
              >）、语音（<em class="c_blue">0</em>）、链接（<em class="c_blue"
                >0</em
              >）
            </div> -->
            <button class="template_btn">确定</button>
          </div>
        </div>
      </div>
    </div>

    <!--添加文字-->
    <div class="pop_bg"></div>
    <div class="pop pop_chart pop_chart_msg pop_chart_msg1">
      <h5 class="t_title">添加文字</h5>
      <div class="detail">
        <div class="dialog_box" style="position: relative">
          <textarea
            name=""
            class="ipt textarea"
            placeholder="请输入..."
          ></textarea>
          <div
            class="positiemoij"
            style="width: 100%;position: absolute;left:0;top: 0;background:#f4f4fc;display: none"
          >
            <div class="expression expression1 one">
              <div class="scroll-wrapper">
                <div class="face-tb">
                  <ul></ul>
                </div>
              </div>
            </div>

            <div class="expression expression2 ">
              <div class="scroll-wrapper">
                <div class="face-tb">
                  <ul></ul>
                </div>
              </div>
            </div>
            <ul class="nextemoij">
              <li>1</li>
              <li>2</li>
            </ul>
          </div>
          <div class="bar clearfix addwenzi">
            <em class="bq"></em>
            <span class="fz fr frs">还可输入300字，按Enter键换行</span>
          </div>
        </div>
      </div>
      <div class="btns clearfix">
        <button class="button this queding1">确定</button>
        <button class="button cancel">取消</button>
      </div>
    </div>

    <!-- 添加图片 -->
    <div class="pop pop_chart pop_chart_msg pop_chart_msg2">
      <h5 class="t_title">添加图片</h5>

      <div class="detail">
        <div class="dialog_box">
          <div style="height:200px;padding:20px">
            <input type="file" />
          </div>
          <div class="pic-list">
            <img class="image" src="" height="200" alt="Image preview..." />
          </div>
        </div>
      </div>
      <div class="btns clearfix">
        <button class="button this queding2">确定</button>
        <button class="button cancel">取消</button>
      </div>
    </div>

    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="layui/layui.js" charset="utf-8"></script>
    <script src="js/common.js" charset="utf-8"></script>
    <script src="js/loginout.js"></script>
    <script src="js/face.js"></script>
    <script>
      layui.use(['form', 'upload', 'laydate'], function() {
        var form = layui.form,
          layer = layui.layer,
          layedit = layui.layedit,
          laydate = layui.laydate,
          upload = layui.upload

        token = localStorage.getItem('token')
        wxid_raw = JSON.parse(localStorage.getItem('wxid_raw'))

        //选择消息设置
        form.on('radio(firstcall)', function(data) {
          console.log(data.value)
          localStorage.setItem('messagecallback', data.value)
        })

        //搜索模板名称
        $('body').delegate('.searchmuban', 'propertychange input', function() {
          console.log($(this).val())
        })

        //搜索模板名称
        var messagecall = 0
        $('body').delegate('.searchkj', 'propertychange input', function() {
          console.log($(this).val())
          localStorage.setItem('messagecall', messagecall)
        })

        //获取好友微信列表
        friend_wxid = JSON.parse(localStorage.getItem('friend_wxid'))

        //添加图片
        // for (var j in wxid_raw) {
        //   for (let i = 0; i < friend_wxid.length; i++) {
        //     $('.dialog_box input').change(function() {
        //       var preview = document.getElementsByClassName('image')
        //       var file = document.querySelector('input[type=file]').files[0]
        //       var reader = new FileReader()

        //       reader.addEventListener(
        //         'load',
        //         function() {
        //           preview.src = reader.result
        //           var baseimg = reader.result
        //           var data =
        //             '{"type":' +
        //             '"send_img",' +
        //             '"wxid":' +
        //             '"' +
        //             wxid_raw[j] +
        //             '",' +
        //             '"to_wxid":' +
        //             '"' +
        //             friend_wxid[i] +
        //             '",' +
        //             '"img":' +
        //             '"' +
        //             baseimg +
        //             '",' +
        //             '"ticket":' +
        //             '"' +
        //             token +
        //             '"' +
        //             '}'
        //           //console.log(data)
        //           $('.pop_chart_msg2').hide()
        //           $('.pop_bg').hide()
        //           // $.ajax({
        //           //   type: 'post',
        //           //   url: 'http://192.168.10.177/api.esp',
        //           //   data: data,
        //           //   async: false,
        //           //   dataType: 'json',
        //           //   success: function(msg) {
        //           //     console.log(msg)
        //           //   },
        //           //   error: function(err) {
        //           //     console.log(err)
        //           //   }
        //           // })
        //         },
        //         false
        //       )
        //       if (file) {
        //         reader.readAsDataURL(file)
        //       }
        //     })
        //   }
        // }

        //添加文字
        $('.txts').click(function() {
          $('.pop_chart_msg1').show()
          $('.pop_bg').show()

          //表情包
          var count = 0
          $('.bq').click(function() {
            count++
            if (count % 2 == 0) {
              $('.positiemoij').hide()
            } else {
              $('.positiemoij').show()
            }
            var content = $('.textarea').val()

            //输入表情
            $('.positiemoij>.expression li').click(function() {
              console.log(content)
              var name = $(this)
                .find('i')
                .get(0)
                .getAttribute('data-name')
              $('.positiemoij').hide()
              //$content += $(".ipt").val("["+name+"]")
              content += '[' + name + ']'

              console.log(content)
              $('.textarea').val(content)
            })
          })
          //点击确定
          var str = ''
          $('.queding1')
            .unbind('click')
            .bind('click', function() {
              //点击确定后在把输入的内容在页面中展示
              if ($('.textarea').val().length > 0) {
                str = `
               <li>
                       <div class="num">
                         <span></span>
                       </div>
                       <div class="details" data-msgtype="text">
                         <div class="text">${$('.textarea').val()}</div>
                     </li>
               `
              }
              $('.msg-list').append(str)
              $('.pop_chart_msg1').hide()
              $('.pop_bg').hide()
              $('.textarea').val('')
            })
        })

        //点击确定的时候
        $('.template_btn').click(function() {
          console.log($('.msg-list').children('li').length)
          //1.输入内容
          var $mubanname = $('.searchmuban').val()
          var $searchkj = $('.searchkj').val()
          console.log($mubanname)
          var mes = $('.msg-list li:nth-child(1)')
            .find('.text')
            .html()
          //判断是否存在输入内容

          if (
            $searchkj.length <= 0 &&
            $('.msg-list').children('li').length == 0
          ) {
            layer.msg('请输入关键字')
            //输入了关键字和内容
          } else if ($searchkj && $('.msg-list').children('li').length == 0) {
            layer.msg('请输入内容')
            $('.template_btn').prop('disabled', true)
            //判断是够输入多条
          } else if ($searchkj && $('.msg-list').children('li').length > 1) {
            layer.msg('只能输入一条')
            //判断是否输入关键字
          } else if (
            $searchkj.length <= 0 &&
            $('.msg-list').children('li').length == 0
          ) {
            layer.msg('请输入关键字')
            //输入了关键字和内容
          } else {
            //2.获取是否第一次回复
            var $num = localStorage.getItem('messagecallback')
            console.log($num)

            var data =
              '{"type":' +
              '"add_auto_send_template",' +
              '"keywords":' +
              '"' +
              $searchkj +
              '",' +
              '"content":' +
              '"' +
              mes +
              '",' +
              '"ticket":' +
              '"' +
              token +
              '"' +
              '}'
            //console.log(data)
            $.ajax({
              type: 'post',
              url: 'http://192.168.10.177/api.esp',
              data: data,
              dataType: 'json',
              success: function(msg) {
                console.log(msg)
                if (msg.err_code == 0) {
                  layer.msg('添加成功')
                  $('.searchkj').val('')
                  $('.msg-list').empty()
                } else {
                  layer.msg('添加失败')
                  $('.searchkj').val('')
                  $('.msg-list').empty()
                }
              },
              error: function(err) {
                console.log(err)
              }
            })
          }
        })
      })

      //添加图片
      $('.pics').click(function() {
        $('.pop_chart_msg2').show()
        $('.pop_bg').show()
      })

      //点击表情换页
      $('.positiemoij>ul li').click(function() {
        var $ind = $(this).text() - 1
        console.log($ind)
        $('.expression')
          .eq($ind)
          .addClass('one')
          .siblings()
          .removeClass('one')
      })

      //控制输入的文字数量
      $('body').delegate('.textarea', 'propertychange input', function() {
        if ($(this).length > 0) {
          var $len = $(this).val().length
          var $inputlen = 300 - $len
          $('.addwenzi .frs').html('还可输入' + $inputlen + '字，按Enter键换行')
          if ($len >= 300) {
            $(this).val(
              $(this)
                .val()
                .substring(0, 300)
            )
            $('.words').html(0)
          }
        } else {
          console.log('未输入')
        }
      })

      //点击文字的删除按钮
      // $('body').delegate('.quit1', 'click', function() {
      //   console.log(21)
      // })

      //点击返回
      $('.backlist').click(function() {
        history.back()
      })
    </script>
  </body>
</html>
