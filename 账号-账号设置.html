<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="layui/css/layui.css"  media="all">
<link rel="stylesheet" href="css/style.css">
<title>账号-账号设置</title>
</head>

<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">
            <img src="images/logo.png" alt="" class="img"/>
        </div>
        <div class="head_right clearfix">
            <div class="top_notice fl">
                <span class="fz">账号设置</span>
                <div class="txt">
                    <li>这里是功能介绍这里是功能介绍这里是功能介绍</li>
                </div>
            </div>
            <!--<div class="top_wz fl">
                <em class="c_blue">567</em>（总使用）/ <em class="c_blue">2000</em>（总端口数）
            </div>-->
            <div class="fr">
                <a href="#" class="r_fz c_blue">查看登陆日志</a>
                <span class="r_fz">xdqy</span>
                <a href="#" class="r_fz c_blue">修改密码</a>
                <span class="quit quits">退出</span>
            </div>
        </div>
    </div> 
    <div class="layui-side left_menu_side">
        <div class="layui-side-scroll">
            <ul class="left_menu">
                <li class="item index">
                    <a href="#">首页</a>
                </li>
                <li class="item account haschild cur">
                    <a href="#">账号</a>
                    <div class="drop">
                        <a href="账号-会员管理.html">分组管理</a>
                        <a href="账号-账号管理.html">账号管理</a>
                        <a href="账号-账号设置.html" class="this">账号设置</a>
                    </div>
                </li>
                <li class="item friend haschild">
                    <a href="#">好友</a>
                    <div class="drop">
                        <a href="好友管理.html">好友管理</a>
                        <a href="好友-加粉任务.html">加粉任务</a>
                        <a href="好友分析.html">好友分析</a>
                    </div>
                </li>
                <li class="item group haschild">
                    <a href="#">群</a>
                    <div class="drop">
                        <a href="群管-拉群任务.html">批量拉群</a>
                        <a href="群管-新建群聊.html">自动群聊</a> 
                    </div>
                </li>
                <li class="item function haschild">
                    <a href="#">功能</a>
                    <div class="drop">
                        <a href="功能-群发消息.html">群发消息</a>
                        <a href="功能-发朋友圈.html">群发朋友圈</a>
                        <a href="功能-朋友圈评论.html">朋友圈评论</a>
                        <a href="功能-素材管理.html">素材管理</a>
                        <a href="#">群发群</a>
                    </div>
                </li>
                <li class="item customer haschild">
                    <a href="#">客服系统</a>
                    <div class="drop">
                        <a href="客服-客服管理.html">客服管理</a>
                        <a href="客服-聊天设置.html">聊天设置</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="layui-body">
        <div class="friend_bar clearfix layui-form friend_bar2">
            <a href="javascript:;" class="anniu adduserBtn">+添加账号分组</a>
            <div class="searchbox fl">
                <input type="text" class="ipt ipt_txt" placeholder="请输入账号昵称"/>
            </div>
            <div class="fr">
                <button class="button button1">编辑打招呼模板</button>
                <button class="button button2">编辑自动回复模板</button>
            </div>
        </div>
        <div class="qg_tit">订单详情</div>
        <div class="qg_main bg_white">
            

            <div class="friend_tablewrap">
                <div class="qg_topbar">
                    <span class="fz">批量操作（已选<em class="c_blue">0</em>）</span>
                    <!-- <span class="button requestBtn">好友请求设置</span> -->
                    <span class="button hiBtn">打招呼内容设置</span>
                    <span class="button chartBtn">群聊邀请设置</span>
                    <span class="button applyBtn">自动回复内容设置</span>
                    <span class="button motionBtn">微信运动</span>
                </div>
                
                <table class="friend_table layui-form friend_table1 p0">
                    <thead>
                        <th width="5%">
                            <input type="checkbox" name="" lay-skin="primary" lay-filter="allChoose">
                        </th>
                        <th width="10%">分组名称</th>
                        <th width="18%">自动通过好友设置</th>
                        <th width="18%">新加好友自动打招呼</th>
                        <th width="18%">自动通过群聊邀请</th>
                        <th width="16%">自动回复内容</th>
                        <th width="15%">微信运动</th>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>安琪</td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>关闭</td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>安琪</td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>关闭</td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>安琪</td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>关闭</td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>安琪</td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>关闭</td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>安琪</td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>关闭</td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>安琪</td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>
                                <span class="set_button">已开启</span>
                            </td>
                            <td>
                                <a href="#" class="lk_ico set">未设置</a>
                            </td>
                            <td>关闭</td>
                        </tr>
                    </tbody>    
                </table>        
                
                <div class="pagelist_wrap">
                    <span class="fz">共144条记录，每页显示</span>
                    <select name="" id="" class="num_box">
                        <option value="">10</option>
                        <option value="">20</option>
                        <option value="">30</option>
                        <option value="">40</option>
                    </select>
                    <div class="pagelist" id="Page">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--弹窗-->
<div class="pop_bg"></div>

<!--好友请求设置-->
<div class="pop pop_zh pop_zh_request">
    <em class="close">&times;</em>
    <div class="t_tit">好友请求设置</div>
    <div class="detail layui-form">
        <p class="fz">已选账号：0个</p>
        <div class="box">
            <li>
                <input type="radio" name="zh" value="1" title="开启自动通过好友请求"  lay-filter="messageset">
            </li>
            <li>
                <input type="radio" name="zh" value="2" title="关闭自动通过好友请求"  lay-filter="messageset">
            </li>
        </div>
        <div class="btns clearfix">
            <button class="button this fl fl1 ">确定</button>
            <button class="button fr cancel">取消</button>
        </div>
    </div>
</div>

<!--好友请求设置-->
<div class="pop pop_zh pop_zh_hi">
    <em class="close">&times;</em>
    <div class="t_tit">打招呼内容设置</div>
    <div class="detail layui-form">
        <p class="fz">已选账号：0个</p>
        <div class="box">
            <li>
                <input type="radio" name="hi" value="1" title="开启自动通过好友请求" lay-filter="messageset1" >
            </li>
            <li>
                <input type="radio" name="chart" value="2" title="关闭自动通过好友请求" lay-filter="messageset1" >
            </li>
        </div>
        <div class="btns clearfix">
            <button class="button this fl fl2">确定</button>
            <button class="button fr cancel">取消</button>
        </div>
    </div>
</div>

<!--群聊邀请设置-->
<div class="pop pop_zh pop_zh_chart">
    <em class="close">&times;</em>
    <div class="t_tit">群聊邀请设置</div>
    <div class="detail layui-form">
        <p class="fz">已选账号：0个</p>
        <div class="box">
            <li>
                <input type="radio" name="chart" value="1" title="开启自动通过群聊邀请" lay-filter="messageset2"  >
            </li>
            <li>
                <input type="radio" name="chart" value="2" title="关闭自动通过群聊邀请" lay-filter="messageset2"  >
            </li>
        </div>
        <div class="btns clearfix">
            <button class="button this fl fl3">确定</button>
            <button class="button fr cancel">取消</button>
        </div>
    </div>
</div>

<!--群聊邀请设置-->
<div class="pop pop_zh pop_zh_motion">
    <em class="close">&times;</em>
    <div class="t_tit">是否开启微信运动</div>
    <div class="detail layui-form">
        <div class="box">
            <li>
                <input type="radio" name="chart" value="1" title="开启" lay-filter="messageset3"  >
            </li>
            <li>
                <input type="radio" name="chart" value="2" title="关闭" lay-filter="messageset3"  >
            </li>
        </div>
        <div class="btns clearfix">
            <button class="button this fl fl4">确定</button>
            <button class="button fr cancel">取消</button>
        </div>
    </div>
</div>
<!--好友请求设置-->
<div class="pop pop_zh pop_zh_apply">
    <em class="close">&times;</em>
    <div class="t_tit">自动回复设置</div>
    <div class="detail layui-form">
        <p class="fz">已选账号：0个</p>
        <div class="box">
            <li>
                <input type="radio" name="chart" value="1" title="开启自动回复设置" lay-filter="messageset4"  >
            </li>
            <li>
                <input type="radio" name="chart" value="2" title="关闭自动回复设置" lay-filter="messageset4"  >
            </li>
        </div>
        <div class="btns clearfix">
            <button class="button this fl fl5">确定</button>
            <button class="button fr cancel">取消</button>
        </div>
    </div>
</div>

<!--添加账号-弹窗-->
<div class="pop pop_zh pop_qg_adduser">
    <em class="close">&times;</em>
    <div class="t_tit">添加账号</div>
    <div class="detail layui-form">
      <div class="searchbox clearfix">
        <input
          type="text"
          class="ipt ipt_txt fl"
          placeholder="请输入关键词搜索"
        />
        <input type="button" class="ipt ipt_button fr" value="搜索" />
      </div>
      <div class="box clearfix">
        <div class="box_l fl">
          <div class="topbar"><em class="fz fl">全选</em>全部账号</div>
          <div class="bottom">
            <li>
              <input
                type="checkbox"
                name="like1[write]"
                lay-skin="primary"
                title=""
              />7.12-(83)
            </li>
            <li>
              <input
                type="checkbox"
                name="like1[write]"
                lay-skin="primary"
                title=""
              />7.12-(83)
            </li>
            <li>
              <input
                type="checkbox"
                name="like1[write]"
                lay-skin="primary"
                title=""
              />7.12-(83)
            </li>
          </div>
        </div>
        <div class="box_r fr">
          <div class="topbar">已选账号<em class="fz fr">清空</em></div>
          <div class="bottom">
            <li>安琪<em class="delete"></em></li>
            <li>安琪<em class="delete"></em></li>
            <li>安琪<em class="delete"></em></li>
            <li>安琪<em class="delete"></em></li>
            <li>安琪<em class="delete"></em></li>
            <li>安琪<em class="delete"></em></li>
            <li>安琪<em class="delete"></em></li>
          </div>
        </div>
      </div>
      <div class="tips">当前已选账号83个</div>
      <div class="btns clearfix">
        <button class="button this">确定</button>
        <button class="button cancel">取消</button>
      </div>
    </div>
  </div>

  <!-- 选择模板 -->
  <div class="pop pop_zh pop_hy_addtag pop_hy_addtag2">
      <em class="close">&times;</em>
      <div class="t_tit">修改基本信息</div>
      <div class="detail layui-form">
        <div class="box box2 layui-form-item">
          <li class="layui-input-block" style="margin-left: 0">
            <select
              class="form-control input-sm"
              name="categorymb"
              lay-filter="categorymb"
              aria-invalid="false"
            >
              <option value=""></option>
              <!-- <option value="0">男</option>
              <option value="1">女</option> -->
            </select>
          </li>
        </div>
        
        <div class="btns clearfix">
          <button class="button this fl fl6">确定</button>
          <button class="button fr cancel">取消</button>
        </div>
      </div>
    </div>




<script src="js/jquery-1.8.3.min.js"></script>
<script src="layui/layui.js" charset="utf-8"></script>
<script src="js/common.js" charset="utf-8"></script>
<script src="js/loginout.js"></script>
<script>
layui.use(['form', 'upload', 'laydate'], function(){
var form = layui.form
,layer = layui.layer
,layedit = layui.layedit
,laydate = layui.laydate
,upload = layui.upload;

token = localStorage.getItem('token')
    wxid_raw = JSON.parse(localStorage.getItem('wxid_raw'))

//全部会员
form.on('select(categorys)', function (data) {
                  categorys = data.value;
                  categoryNames = data.elem[data.elem.selectedIndex].text;
                  console.log(categoryNames)
                  form.render('select');
                });

//好友请求设置
form.on('radio(messageset)', function(data) {
          console.log(data.value)
          localStorage.setItem("friendset",data.value)
        })

     

                //群聊邀请设置
form.on('radio(messageset2)', function(data) {
        
          console.log(data.value)
          localStorage.setItem("qunset",data.value)
        })

   

              //微信运动
form.on('radio(messageset3)', function(data) {
          
          console.log(data.value)
          localStorage.setItem("sportwx",data.value)
        })

                      //自动回复
form.on('radio(messageset4)', function(data) {
          
          console.log(data.value)
          localStorage.setItem("automesg",data.value)
        })



//群发对象
form.on('select(category)', function(data) {
  category = data.value
  categoryName = data.elem[data.elem.selectedIndex].text
  console.log(categoryName)
  form.render('select')
})

//获取所有自动回复的模板
var data =
          '{"type":' +
          '"get_add_auto_send_template",' +
          '"ticket":' +
          '"' +
          token +
          '"' +
          '}'
        console.log(data)
        $.ajax({
          type: 'post',
          url: 'http://192.168.10.177/api.esp',
          data: data,
          dataType: 'json',
          success: function(msg) {
            console.log(msg)
            if (msg.err_code == 0) {
              var data = msg.data
              var str = ""
              for(var i in data){
                str += `
                <option value="${data[i].content}">${data[i].content}</option>
                `
              }
              $(".input-sm").append(str)
              form.render()
            } else {
              layer.msg('添加成功')
              location.reload()
            }
          },
          error: function(err) {
            console.log(err)
          }
        })


 //全选
var count = 0;
form.on('checkbox(allChoose)', function(data){
    var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
    //所有的子元素数量
    var total = $(data.elem).parents('table').find('tbody input[type="checkbox"]').length;

   
    count++;
    if(count%2 !== 0){
        console.log("全选")
        $(".qg_topbar span:first-child").find("em").text(total)
        //打招呼内容设置数量
    $(".pop_zh_hi .fz").text("已选账号：" + total + "个")
    $(".pop_zh_chart .fz").text("已选账号：" + total + "个")
    $(".pop_zh_apply .fz").text("已选账号：" + total + "个")
    // $(".pop_zh_hi .fz").text("已选账号：" + total + "个")

    }else{
        console.log("全不选")
        $(".qg_topbar span:first-child").find("em").text(0)
        //打招呼内容设置数量
    $(".pop_zh_hi .fz").text("已选账号：" + 0 + "个")
    $(".pop_zh_chart .fz").text("已选账号：" + 0 + "个")
    $(".pop_zh_apply .fz").text("已选账号：" + 0 + "个")
    // $(".pop_zh_hi .fz").text("已选账号：" + 0 + "个")
    }
    var imgArr = []
    child.each(function(index, item){
        item.checked = data.elem.checked;
        imgArr.push(item)

    });
    console.log(imgArr)

    for(let i = 0; i < imgArr.length; i++){
      
      //打招呼内容设置
     form.on('radio(messageset1)', function(data) {
      
         console.log(data.value)
         var sayhi = data.value
         $(".fl2").click(function(){
           if(sayhi == 1){
             //群发对象
            form.on('select(categorymb)', function(data) {
              category = data.value
              categoryName = data.elem[data.elem.selectedIndex].text
              console.log(categoryName)
              form.render('select')
              $(".fl6").click(function(){
                console.log(categoryName)
                for(var i in wxid_raw){
                    var data =
                           '{"type":' +
                           '"add_auto_send",' +
                           '"wxid":' +
                           '"'+wxid_raw[i]+'",' +
                           '"content":' +
                           '"'+categoryName+'",' +
                           '"ticket":' +
                           '"'+token+'"' +
                           '}'
                           //console.log(data)
                           $.ajax({
                             type: 'post',
                               url: 'http://192.168.10.177/api.esp',
                               data:data,
                               dataType: 'json',
                               success:function(msg){
                                 //console.log(msg)
                                 if(msg.err_code == 0){
                                   layer.msg("设置成功")
                                 }else{
                                   layer.msg("设置失败")
                                 }
                               },
                               error:function(err){
                                 console.log(err)
                               }
                           })
              }
              })
            })

          }else{
            for(var i in wxid_raw){
            var data =
                        '{"type":' +
                        '"add_auto_send",' +
                        '"wxid":' +
                        '"'+wxid_raw[i]+'",' +
                        '"content":' +
                        '" ",' +
                        '"ticket":' +
                        '"'+token+'"' +
                        '}'
                        //console.log(data)
                        $.ajax({
                          type: 'post',
                            url: 'http://192.168.10.177/api.esp',
                            data:data,
                            dataType: 'json',
                            success:function(msg){
                              console.log(msg)
                              if(msg.err_code == 0){
                                layer.msg("设置成功")
                              }else{
                                layer.msg("设置失败")
                              }
                            },
                            error:function(err){
                              console.log(err)
                            }
                        })
          }
        }
         })
     })
    
    
     //自动回复内容
     form.on('radio(messageset4)', function(data) {
      console.log(data.value)
      var autosend = data.value
      $(".fl5").click(function(){
        if(autosend == 1){
          location.href="账号-自动回复模板2.html"
          localStorage.getItem("arrOne")

          var zidong = JSON.parse(localStorage.getItem("arrOne"))
          if(zidong){
            var str = ""
            for(var i in zidong){
              str += zidong[i].keywords + "#" + zidong[i].muban + "|"
            }
            console.log(str)
            for(var j in wxid_raw){
                  var data =
                             '{"type":' +
                             '"auto_send",' +
                             '"wxid":' +
                             '"'+wxid_raw[j]+'",' +
                             '"keywords":' +
                             '"'+str+'",' +
                             '"ticket":' +
                             '"'+token+'"' +
                             '}'
                             //console.log(data)
                             $.ajax({
                              type: 'post',
                              url: 'http://192.168.10.177/api.esp',
                              data:data,
                              dataType: 'json',
                              success:function(msg){
                                console.log(msg)
                                if(msg.err_code == 0){
                                  layer.msg("设置成功")
                                  localStorage.removeItem("arrOne")
                                  $(".pop_zh_apply").hide()
                                  $('.pop_bg').hide();
                                }else{
                                  layer.msg("设置失败")
                                }
                              },
                              error:function(err){
                                console.log(err)
                              }
                             })
                            }
          }

        }else{
          for(var j in wxid_raw){
                var data =
                           '{"type":' +
                           '"auto_send",' +
                           '"wxid":' +
                           '"'+wxid_raw[j]+'",' +
                           '"keywords":' +
                           '"",' +
                           '"ticket":' +
                           '"'+token+'"' +
                           '}'
                           //console.log(data)
                           $.ajax({
                            type: 'post',
                            url: 'http://192.168.10.177/api.esp',
                            data:data,
                            dataType: 'json',
                            success:function(msg){
                              //console.log(msg)
                              if(msg.err_code == 0){
                                layer.msg("设置成功")
                              }else{
                                layer.msg("设置失败")
                              }
                            },
                            error:function(err){
                              console.log(err)
                            }
                           })
                          }

        }
      })
     })


    }

    

    
    
    
    form.render('checkbox');
});
form.on('checkbox(itemChoose)',function(data){
    var sib = $(data.elem).parents('table').find('tbody input[type="checkbox"]:checked').length;
    var total = $(data.elem).parents('table').find('tbody input[type="checkbox"]').length;
    $(".qg_topbar span:first-child").find("em").text(sib)
    if(sib == total){
        $(data.elem).parents('table').find('thead input[type="checkbox"]').prop("checked",true);
        form.render();
    }else{
        $(data.elem).parents('table').find('thead input[type="checkbox"]').prop("checked",false);
        form.render();
    }
}); 


$(".button1").click(function(){
    location.href="账号-打招呼模板2.html"
})

$(".button2").click(function(){
    location.href="账号-自动回复模板2.html"
})

//点击弹窗
$('.adduserBtn').click(function() {
  $('.pop_qg_adduser').show()
  $('.pop_bg').show()
})


$('.requestBtn').click(function(){
    $('.pop_zh_request').show();
    $('.pop_bg').show();
});
$('.hiBtn').click(function(){
    $('.pop_zh_hi').show();
    $('.pop_bg').show();
});
$('.chartBtn').click(function(){
    $('.pop_zh_chart').show();
    $('.pop_bg').show();
});
$('.applyBtn').click(function(){
    $('.pop_zh_apply').show();
    $('.pop_bg').show();
});
$('.motionBtn').click(function(){
    $('.pop_zh_motion').show();
    $('.pop_bg').show();
});

$(".fl2").click(function(){
  $(".pop_hy_addtag2").show();
  $('.pop_bg').show();
  $(".pop_zh_hi").hide()
})

$(".fl6").click(function(){
  $(".pop_hy_addtag2").hide()
})
 
});

</script>
<script type="text/javascript" src="js/mypage.js"></script>
<script type="text/javascript">
    P.initMathod({
        params: {elemId: '#Page',total:'123'},
        requestFunction: function () {
           // P.config.total = parseInt(Math.random() * 10 + 85);//此处模拟总记录变化

            //TODO ajax异步请求过程,异步获取到的数据总条数赋值给 P.config.total
            
            //列表渲染自行处理
            
            console.log(JSON.stringify(P.config));
        }
    });
</script>
</body>
</html>
