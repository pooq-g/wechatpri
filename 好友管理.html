<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="layui/css/layui.css"  media="all">
<link rel="stylesheet" href="css/style.css">
<title>好友管理</title>
</head>

<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">
            <img src="images/logo.png" alt="" class="img"/>
        </div>
        <div class="head_right clearfix">
            <div class="top_notice fl">
                <span class="fz">好友管理</span>
                <div class="txt">
                    <li>这里是功能介绍这里是功能介绍这里是功能介绍</li>
                </div>
            </div>
            <div class="fr">
                <a href="#" class="r_fz c_blue">查看登陆日志</a>
                <span class="r_fz">xdqy</span>
                <a href="#" class="r_fz c_blue">修改密码</a>
                <span class="quit quits">退出</span>
            </div>
        </div>
        
    </div> 
    <div class="layui-side left_menu_side">
        <div class="layui-side-scroll">
            <ul class="left_menu">
                <li class="item index">
                    <a href="#">首页</a>
                </li>
                <li class="item account haschild">
                    <a href="#">账号</a>
                    <div class="drop">
                        <a href="账号-会员管理.html">会员管理</a>
                        <a href="账号-账号管理.html">账号管理</a>
                        <a href="账号-账号设置.html">账号设置</a>
                    </div>
                </li>
                <li class="item friend haschild cur">
                    <a href="#">好友</a>
                    <div class="drop">
                        <a href="好友管理.html" class="this">好友管理</a>
                        <a href="好友-加粉任务.html">加粉任务</a>
                        <a href="好友分析.html">好友分析</a>
                    </div>
                </li>
                <li class="item group haschild">
                    <a href="#">群</a>
                    <div class="drop">
                        <a href="#">批量拉群</a>
                        <a href="#">自动群聊</a>
                    </div>
                </li>
                <li class="item function haschild">
                    <a href="#">功能</a>
                    <div class="drop">
                        <a href="功能-群发消息.html">群发消息</a>
                        <a href="功能-发朋友圈.html">群发朋友圈</a>
                        <a href="功能-朋友圈评论.html">朋友圈评论</a>
                        <a href="功能-素材管理.html">素材管理</a>
                    </div>
                </li>
                <li class="item customer haschild">
                    <a href="#">客服系统</a>
                    <div class="drop">
                        <a href="客服-客服管理.html">客服管理</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="layui-body">
        <div class="friend_menu clearfix friend_menu2">
            <li class="item item_1">
                <div class="box">
                    <p class="fz"><img src="images/icon_10.png" alt="" class="ico"/>好友总数</p>
                    <p class="num">23996</p>
                </div>
            </li>
            <li class="item item_2">
                <div class="box">
                    <p class="fz"><img src="images/icon_11.png" alt="" class="ico"/>新增好友</p>
                    <p class="num">23996</p>
                </div>
            </li>
            <li class="item item_3">
                <div class="box">
                    <p class="fz"><img src="images/icon_12.png" alt="" class="ico"/>在线账号</p>
                    <p class="num">23996</p>
                </div>
            </li>
            <li class="item item_4">
                <div class="box">
                    <h6 class="title">全部好友（10378）</h6>
                    <div class="txt">
                        <p><a href="#">测试（10378）</a></p>
                        <p><a href="#">123（10378）</a></p>
                        <p><a href="#">啊啊（10378）</a></p>
                    </div>
                </div>
            </li>
        </div>
        <div class="friend_bottom">
            <h6 class="firend_tit">好友列表</h6>
            <div class="friend_bar clearfix layui-form">
                <div class="selectbox fl">
                    <select name="" id="">
                        <option value="1">全部</option>
                        <option value="2">全部</option>
                        <option value="3">全部</option>
                    </select>
                </div>
                <div class="selectbox fl">
                    <select name="" id="">
                        <option value="1">标签</option>
                        <option value="2">标签</option>
                        <option value="3">标签</option>
                    </select>
                </div>
                <div class="searchbox fl">
                    <input type="text" class="ipt ipt_txt" placeholder="请输入好友昵称"/>
                </div>
                <button class="button add fr addtagBtn">新建标签</button>
            </div>
            <div class="friend_tablewrap">
                <table class="friend_table layui-form text-left">
                    <thead>
                        <th width="8%">
                            <input type="checkbox" name="" lay-skin="primary" lay-filter="allChoose">&nbsp;&nbsp;全选
                        </th>
                        <th width="12%">微信号</th>
                        <th width="12%">好友昵称</th>
                        <th width="10%">备注</th>
                        <th width="15%">
                            <em class="tag edittagBtn">标签</em>
                        </th>
                        <th width="10%">所属账号</th>
                        <th width="12%">聊天记录</th>
                        <th width="21%">操作</th>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>A1037937287</td>
                            <td>小猪佩琪</td>
                            <td>安德镇</td>
                            <td>
                                <em class="c_blue">同学家庭</em>
                            </td>
                            <td>赵辽源</td>
                            <td>
                                <a href="javascript:;" class="lk c_blue chartdetBtn">查看详情</a>
                            </td>
                            <td>
                                <a href="javascript:;" class="lk_ico chart msgBtn">去聊天</a>
                                <a href="javascript:;" class="lk_ico quan chartquanBtn">朋友圈</a>
                            </td>
                        </tr>
                     <!--    <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>A1037937287</td>
                            <td>小猪佩琪</td>
                            <td>安德镇</td>
                            <td>
                                <em class="c_green">同学家庭</em>
                            </td>
                            <td>赵辽源</td>
                            <td>
                                <a href="javascript:;" class="lk c_blue chartdetBtn">查看详情</a>
                            </td>
                            <td>
                                <a href="javascript:;" class="lk_ico chart msgBtn">去聊天</a>
                                <a href="javascript:;" class="lk_ico quan chartquanBtn">朋友圈</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>A1037937287</td>
                            <td>小猪佩琪</td>
                            <td>安德镇</td>
                            <td>
                                <em class="c_org">同学家庭</em>
                            </td>
                            <td>赵辽源</td>
                            <td>
                                <a href="javascript:;" class="lk c_blue chartdetBtn">查看详情</a>
                            </td>
                            <td>
                                <a href="javascript:;" class="lk_ico chart msgBtn">去聊天</a>
                                <a href="javascript:;" class="lk_ico quan chartquanBtn">朋友圈</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>A1037937287</td>
                            <td>小猪佩琪</td>
                            <td>安德镇</td>
                            <td>
                                <em class="c_org">同学家庭</em>
                            </td>
                            <td>赵辽源</td>
                            <td>
                                <a href="javascript:;" class="lk c_blue chartdetBtn">查看详情</a>
                            </td>
                            <td>
                                <a href="javascript:;" class="lk_ico chart msgBtn">去聊天</a>
                                <a href="javascript:;" class="lk_ico quan chartquanBtn">朋友圈</a>
                            </td>
                        </tr> -->
                    </tbody>
                </table>
                <div class="pagelist_wrap">
                    <span class="fz">共144条记录，每页显示</span>
                    <select name="" id="" class="num_box">
                        <option value="">10</option>
                        <option value="">20</option>
                        <option value="">30</option>
                        <option value="">40</option>
                    </select>
                    <div class="pagelist" id="Page">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--新建标签-->
<div class="pop_bg"></div>
<div class="pop pop_zh pop_hy_addtag">
    <em class="close">&times;</em>
    <div class="t_tit">新建标签</div>
    <div class="detail layui-form">
        <div class="box">
            <li>
               <input type="text" class="ipt ipt_txt"/>
            </li>
        </div>
        <div class="btns clearfix">
            <button class="button this fl queding1">确定</button>
            <button class="button fr cancel">取消</button>
        </div>
    </div>
</div>

<!--好友发送消息-->
<div class="pop pop_chart pop_chart_msg">
    <h5 class="t_title">聊天详情</h5>
    
    <div class="detail">
        <div class="topbar clearfix">
            <span class="fz fl">好友昵称：王展鹏</span>
            <span class="fz fr">所属账号：邵磊盛</span>
        </div>
        <div class="dialog_box" style="position: relative">
            <textarea name="" class="ipt textarea" placeholder="请输入..."></textarea>
            <div class="positiemoij" style="width: 100%;position: absolute;left:0;top: 0;background:#f4f4fc;display: none">
                    <div class="expression expression1 one" >
                            <div class="scroll-wrapper">
                              <div class="face-tb">
                                  <ul>
                                    
                                  </ul>
                                </div>
                              </div>
                            </div>
                      
                            <div class="expression expression2 " >
                                <div class="scroll-wrapper">
                                  <div class="face-tb">
                                      <ul>
                                        
                                      </ul>
                                    </div>
                                  </div>
                                </div>
                                <ul>
                                  <li>1</li>
                                  <li>2</li>
                                </ul>
            </div>
            <div class="bar clearfix group-sending">
                <em class="bq"></em>
                <span class="fz fr frs">还可输入3000字，按Enter键换行</span>
                
                <!--  -->
            </div>
        </div>
    </div>
    <div class="btns clearfix">
        <button class="button this queding2">确定</button>
        <button class="button cancel">取消</button>
    </div>
</div>

<!--聊天详情-->
<div class="pop pop_chart pop_chart_det">
    <h5 class="t_title">聊天详情</h5>
    <div class="detail">
        <div class="topbar clearfix">
            <span class="fz fl">好友昵称：王展鹏</span>
            <span class="fz fr">所属账号：邵磊盛</span>
        </div>
        <div class="chartdet">
            <li class="odd">
                <img src="images/icon_34.png" alt="" class="hdimg"/>
                <div class="info">
                    <p class="date">2019-07-03 21:49:58</p>
                    <div class="txt">
                        我通过了您的好友验证请求，现在我们可以开始聊天了
                    </div>
                </div>
            </li>
            <!--<li class="even">
                <img src="images/icon_34.png" alt="" class="hdimg"/>
                <div class="info">
                    <p class="date">2019-07-03 21:49:58</p>
                    <div class="txt">
                        我通过了您的好友验证请求，现在我们可以开始聊天了
                    </div>
                </div>
            </li>-->
        </div>
        <div class="btns clearfix center">
            <button class="button this cancel">关闭</button>
        </div>
    </div>
</div>

<!--我的朋友圈-->
<div class="pop pop_chart pop_chart_quan">
    <em class="close">&times;</em>
    <h5 class="t_title"><img src="images/icon_35.png" alt="" class="ico"/>我的朋友圈</h5>
    <div class="detail">
        <img src="images/icon_36.png" alt="" class="hdimg"/>
        <h6 class="name"><span>Alina Judy</span></h6>
        <button class="status_button">账号未登录</button>
    </div>
</div>
<!--修改标签-->
<div class="pop pop_zh pop_hy_edittag">
    <em class="close">&times;</em>
    <div class="t_tit">修改标签</div>
    <div class="detail layui-form">
        <div class="box">
            <li class="grp">
               <input type="radio" name="tag" value="" title="测试" >
            </li>
            <li class="grp">
               <input type="radio" name="tag" value="" title="123" >
            </li>
            <li class="grp">
               <input type="radio" name="tag" value="啊啊" title="啊啊" >
            </li>
        </div>
        <span class="addbq">+新建标签 </span>
        <div class="btns clearfix">
            <button class="button this fl queding3">确定</button>
            <button class="button fr cancel">取消</button>
        </div>
    </div>
</div>






<script src="js/jquery-1.8.3.min.js"></script>
<script src="layui/layui.js" charset="utf-8"></script>
<script src="js/common.js" charset="utf-8"></script>
<!-- <script src="js/loginout.js"></script> -->
<script src="js/norepeat.js"></script>
<script src="js/face.js"></script>
<script>
layui.use(['form', 'upload', 'laydate'], function(){
var form = layui.form
,layer = layui.layer
,layedit = layui.layedit
,laydate = layui.laydate
,upload = layui.upload;

token = localStorage.getItem("token")
wxid_raw =JSON.parse(localStorage.getItem("wxid_raw"))
for(var id in wxid_raw){
        var data =
        '{"type":' +
        '"get_friend_list",' +
        '"wxid":' +
        '"'+wxid_raw[id]+'",' +
        '"limit1":' +
        '"'+0+'",' +
        '"limit2":' +
        '"'+20+'",' +
        '"ticket":' +
        '"'+token+'"' +
        '}'

        //传入参数
        //console.log(data)

        $.ajax({
        type: 'post',
        url: 'http://192.168.10.177/api.esp',
        data:data,
        dataType: 'json',
        success:function(msg){
            console.log(msg)
            if(msg.err_code == 0){
                var data = msg.data
                console.log(data)
                var str = "";
                var ind = 0
                let msglist = []
                var wxfrom = []
                for(var id in data){
                    //存储本人账号对应以及对应的好友账号
                    wxfrom.push({"selfwx":data[id].from_wxid,"fronwx":data[id].friend_wxid})
                    wxfrom = norepeat(wxfrom)
                    console.log(wxfrom)
                    localStorage.setItem("wxfrom",JSON.stringify(wxfrom))


                    msglist.push(data[id].friend_wxid)
                    msglist = norepeat(msglist)
                    str += `
                    <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="itemChoose">
                            </td>
                            <td>${data[id].friend_wxid}</td>
                            <td>
                                    <img src="${data[id].headurl}" data-id=${data[id].id} style="width:31px;height:31px;border-radius:50%">
                                ${data[id].nickname}</td>
                            <td>${data[id].friend_wxid}</td>
                            <td>
                                <em class="c_blue">同学家庭</em>
                            </td>
                            <td>${data[id].from_wxid}</td>
                            <td>
                                <a href="javascript:;" class="lk c_blue chartdetBtn">查看详情</a>
                            </td>
                            <td>
                                <a href="javascript:;" class="lk_ico chart msgBtn" data-friend=${data[id].friend_wxid} data-nickname=${data[id].nickname}>去聊天</a>
                                <a href="javascript:;" class="lk_ico quan chartquanBtn">朋友圈</a>
                            </td>
                        </tr>
                    `
                }
                $("tbody").append(str)  
                localStorage.setItem("friend_wxid",JSON.stringify(msglist))
                form.render('checkbox');
            }
        },
        error:function(err){
            console.log(err)
        }
    })
}


form.on('checkbox(allChoose)', function(data){
    var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
    child.each(function(index, item){
        item.checked = data.elem.checked;
    });
    form.render('checkbox');
});
form.on('checkbox(itemChoose)',function(data){
    var sib = $(data.elem).parents('table').find('tbody input[type="checkbox"]:checked').length;
    var total = $(data.elem).parents('table').find('tbody input[type="checkbox"]').length;
    if(sib == total){
        $(data.elem).parents('table').find('thead input[type="checkbox"]').prop("checked",true);
        form.render();
    }else{
        $(data.elem).parents('table').find('thead input[type="checkbox"]').prop("checked",false);
        form.render();
    }
}); 

$('.addtagBtn').click(function(){
    $('.pop_hy_addtag').show();
    $('.pop_bg').show();
});



//去聊天
$("body").delegate(".msgBtn","click",function(){
    $('.pop_chart_msg').show();
    $('.pop_bg').show();
    var $friend = $(this).get(0).getAttribute("data-friend")
    var nickname = $(this).get(0).getAttribute("data-nickname")
    nickname = "好友昵称：" + nickname
    $(".pop_chart_msg .fl").html(nickname)

   
    //表情包
    var count = 0
    $(".bq").click(function(){
        count++
        if(count%2 == 0){
            $(".positiemoij").hide()
        }else{
            $(".positiemoij").show()
        }
        var content = $(".textarea").val()

        //输入表情
        $(".positiemoij>.expression li").click(function(){
            console.log(content)
            var name = $(this).find("i").get(0).getAttribute("data-name")
            $(".positiemoij").hide()
            //$content += $(".ipt").val("["+name+"]")
            content += "["+name+"]"
                
                console.log(content)
                $(".textarea").val(content)
            })

    })

    
    
    $(".queding2").click(function(){
        $(".positiemoij").hide()
        var $content = $("textarea").val()
        var data =
        '{"type":' +
        '"send_msg",' +
        '"wxid":' +
        '"'+wxid_raw+'",' +
        '"to_wxid":' +
        '"z1161091470",' +
        '"content":' +
        '"'+$content+'",' +
        '"ticket":' +
        '"'+token+'"' +
        '}'
        //console.log(data)

        $.ajax({
            type: 'post',
            url: 'http://192.168.10.177/api.esp',
            data:data,
            dataType: 'json',
            success:function(msg){
                //console.log(msg)
                if(msg.err_code == 0){
                    $('.pop_hy_addtag1').hide();
                    $('.pop_bg').hide();
                    layer.msg("发送成功")
                }else{
                    layer.msg("发送失败")
                }
                $("textarea").val("")
            },
            error:function(err){
                console.log(err)
            }
        })
    })
    
})
//去朋友圈
$("body").delegate(".chartquanBtn","click",function(){
    $('.pop_chart_quan').show();
    $('.pop_bg').show();
})

$("body").delegate(".chartdetBtn","click",function(){
    $('.pop_chart_det').show();
    $('.pop_bg').show();
})


// $('.chartdetBtn').click(function(){
//     $('.pop_chart_det').show();
//     $('.pop_bg').show();
// });  
 
$('.edittagBtn').click(function(){
    $('.pop_hy_edittag').show();
    $('.pop_bg').show();
});
  
});

$(".positiemoij>ul li").click(function(){
    var $ind = $(this).text()-1
    console.log($ind)
    $(".expression").eq($ind).addClass("one").siblings().removeClass("one")
})



//控制输入的文字数量
$("body").delegate(".ipt","propertychange input",function(){
    if($(this).length > 0){
        var $len = $(this).val().length
        var $inputlen = 3000-$len;
        $(".frs").html("还可输入"+$inputlen +"字，按Enter键换行")
        if($len >= 3000){ 
            $(this).val($(this).val().substring(0,3000));    
            $(".words").html(0)
        }
    }else{
        console.log("未输入")
    }
})
</script>
<script type="text/javascript" src="js/mypage.js"></script>

<script type="text/javascript">
    P.initMathod({
        params: {elemId: '#Page',total:'123'},
        requestFunction: function () {
           // P.config.total = parseInt(Math.random() * 10 + 85);//此处模拟总记录变化

            //TODO ajax异步请求过程,异步获取到的数据总条数赋值给 P.config.total
            
            //列表渲染自行处理
            
            console.log(JSON.stringify(P.config));
        }
    });
</script>
</body>
</html>
